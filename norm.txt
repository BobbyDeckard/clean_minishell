In extract_tokens: while loop is infinite without current safeguard (need debug)
